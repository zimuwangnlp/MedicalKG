{"remainingRequest":"/Users/shonichikun/Downloads/西浦资料/authorityForecast/node_modules/babel-loader/lib/index.js!/Users/shonichikun/Downloads/西浦资料/authorityForecast/node_modules/vue-loader-v16/dist/templateLoader.js??ref--6!/Users/shonichikun/Downloads/西浦资料/authorityForecast/node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js??ref--1-0!/Users/shonichikun/Downloads/西浦资料/authorityForecast/node_modules/vue-loader-v16/dist/index.js??ref--1-1!/Users/shonichikun/Downloads/西浦资料/authorityForecast/src/frameworks/transition.vue?vue&type=template&id=50548834&scoped=true","dependencies":[{"path":"/Users/shonichikun/Downloads/西浦资料/authorityForecast/src/frameworks/transition.vue","mtime":1657271700000},{"path":"/Users/shonichikun/Downloads/西浦资料/authorityForecast/babel.config.js","mtime":1654570980000},{"path":"/Users/shonichikun/Downloads/西浦资料/authorityForecast/node_modules/@vue/cli-plugin-babel/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/shonichikun/Downloads/西浦资料/authorityForecast/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/shonichikun/Downloads/西浦资料/authorityForecast/node_modules/vue-loader-v16/dist/templateLoader.js","mtime":499162500000},{"path":"/Users/shonichikun/Downloads/西浦资料/authorityForecast/node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/shonichikun/Downloads/西浦资料/authorityForecast/node_modules/vue-loader-v16/dist/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgcmVzb2x2ZURpcmVjdGl2ZSBhcyBfcmVzb2x2ZURpcmVjdGl2ZSwgd2l0aERpcmVjdGl2ZXMgYXMgX3dpdGhEaXJlY3RpdmVzLCBvcGVuQmxvY2sgYXMgX29wZW5CbG9jaywgY3JlYXRlRWxlbWVudEJsb2NrIGFzIF9jcmVhdGVFbGVtZW50QmxvY2ssIHB1c2hTY29wZUlkIGFzIF9wdXNoU2NvcGVJZCwgcG9wU2NvcGVJZCBhcyBfcG9wU2NvcGVJZCB9IGZyb20gInZ1ZSI7Cgpjb25zdCBfd2l0aFNjb3BlSWQgPSBuID0+IChfcHVzaFNjb3BlSWQoImRhdGEtdi01MDU0ODgzNCIpLCBuID0gbigpLCBfcG9wU2NvcGVJZCgpLCBuKTsKCmNvbnN0IF9ob2lzdGVkXzEgPSB7CiAgY2xhc3M6ICJsb2dpbiIKfTsKZXhwb3J0IGZ1bmN0aW9uIHJlbmRlcihfY3R4LCBfY2FjaGUsICRwcm9wcywgJHNldHVwLCAkZGF0YSwgJG9wdGlvbnMpIHsKICBjb25zdCBfZGlyZWN0aXZlX2xvYWRpbmcgPSBfcmVzb2x2ZURpcmVjdGl2ZSgibG9hZGluZyIpOwoKICByZXR1cm4gX3dpdGhEaXJlY3RpdmVzKChfb3BlbkJsb2NrKCksIF9jcmVhdGVFbGVtZW50QmxvY2soImRpdiIsIF9ob2lzdGVkXzEsIG51bGwsIDUxMgogIC8qIE5FRURfUEFUQ0ggKi8KICApKSwgW1tfZGlyZWN0aXZlX2xvYWRpbmcsICRkYXRhLmxvYWRpbmddXSk7Cn0="},{"version":3,"mappings":";;;;;EASOA,KAAK,EAAC;;;;;wCAAXC,oBAA6C,KAA7C,cAA6C,IAA7C,EAA6C;EAAA;EAA7C,IAA6C,sBAAfC,cAAe","names":["class","_createElementBlock","$data"],"sourceRoot":"","sources":["/Users/shonichikun/Downloads/西浦资料/authorityForecast/src/frameworks/transition.vue"],"sourcesContent":["<style lang=\"scss\" scoped>\r\n  .login {\r\n    height: 100vh;\r\n    background: url(~@/assets/img/bg_shadow.png) no-repeat center center;\r\n    background-size: cover;\r\n    overflow: hidden;\r\n  }\r\n</style>\r\n<template>\r\n  <div class=\"login\" v-loading=\"loading\"></div>\r\n</template>\r\n<script>\r\n  import constant from \"@/assets/js/constant\";\r\n  export default {\r\n    name: \"transition\",\r\n    data() {\r\n      return {\r\n        loading: true,\r\n      };\r\n    },\r\n    created() {\r\n      // cas重定向回来的 url中获取 code参数\r\n      let code = util.getCode();\r\n      if (code) {\r\n        // 根据 code获取 token\r\n        this.getTokenByCode(code);\r\n      }\r\n      else {\r\n        util.login();\r\n      }\r\n    },\r\n    mounted() { },\r\n    methods: {\r\n      getUserInfo(token) {\r\n        adapter.getUserInfo({access_token: token}, function(res) {\r\n          if (res.data) {\r\n              var userInfo = res.data.data;\r\n              sessionStorage.setItem(\"userId\", userInfo.id);\r\n              sessionStorage.setItem(\"userInfo\", JSON.stringify(userInfo));\r\n              adapter.getUserRole({\r\n                  access_token: token,\r\n                  offset: -1\r\n                }, function(tData) {\r\n                console.log(tData.data);\r\n                var roles = tData.data.data || []\r\n                sessionStorage.setItem(\"roles\", JSON.stringify(roles));\r\n                location.href = location.protocol + \"//\" + location.host;\r\n              }, {\r\n                userId: userInfo.id\r\n              })\r\n              \r\n            }\r\n        })\r\n      },\r\n      getTokenByCode(code) {\r\n        var url = location.protocol + \"//\" + location.host;\r\n        var data = {\r\n          \"grant_type\":  \"authorization_code\",\r\n          \"client_id\": constant.appId,\r\n          \"code\": code,\r\n          \"client_secret\": constant.client_secret,\r\n          \"redirect_uri\" : url\r\n        }\r\n        var _self = this;\r\n        adapter.getUserToken(data, function(res){\r\n          const token = res.data.access_token;\r\n          sessionStorage.setItem(\"token\", token);\r\n          _self.getUserInfo(token);\r\n        });\r\n      }\r\n    },\r\n  };\r\n</script>"]}]}