{"remainingRequest":"/Users/shonichikun/Downloads/西浦资料/authorityForecast/node_modules/babel-loader/lib/index.js!/Users/shonichikun/Downloads/西浦资料/authorityForecast/node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js??ref--1-0!/Users/shonichikun/Downloads/西浦资料/authorityForecast/node_modules/vue-loader-v16/dist/index.js??ref--1-1!/Users/shonichikun/Downloads/西浦资料/authorityForecast/src/frameworks/transition.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/shonichikun/Downloads/西浦资料/authorityForecast/src/frameworks/transition.vue","mtime":1657271700000},{"path":"/Users/shonichikun/Downloads/西浦资料/authorityForecast/babel.config.js","mtime":1654570980000},{"path":"/Users/shonichikun/Downloads/西浦资料/authorityForecast/node_modules/@vue/cli-plugin-babel/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/shonichikun/Downloads/西浦资料/authorityForecast/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/shonichikun/Downloads/西浦资料/authorityForecast/node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/shonichikun/Downloads/西浦资料/authorityForecast/node_modules/vue-loader-v16/dist/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IGNvbnN0YW50IGZyb20gIkAvYXNzZXRzL2pzL2NvbnN0YW50IjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJ0cmFuc2l0aW9uIiwKCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGxvYWRpbmc6IHRydWUKICAgIH07CiAgfSwKCiAgY3JlYXRlZCgpIHsKICAgIC8vIGNhc+mHjeWumuWQkeWbnuadpeeahCB1cmzkuK3ojrflj5YgY29kZeWPguaVsAogICAgbGV0IGNvZGUgPSB1dGlsLmdldENvZGUoKTsKCiAgICBpZiAoY29kZSkgewogICAgICAvLyDmoLnmja4gY29kZeiOt+WPliB0b2tlbgogICAgICB0aGlzLmdldFRva2VuQnlDb2RlKGNvZGUpOwogICAgfSBlbHNlIHsKICAgICAgdXRpbC5sb2dpbigpOwogICAgfQogIH0sCgogIG1vdW50ZWQoKSB7fSwKCiAgbWV0aG9kczogewogICAgZ2V0VXNlckluZm8odG9rZW4pIHsKICAgICAgYWRhcHRlci5nZXRVc2VySW5mbyh7CiAgICAgICAgYWNjZXNzX3Rva2VuOiB0b2tlbgogICAgICB9LCBmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgaWYgKHJlcy5kYXRhKSB7CiAgICAgICAgICB2YXIgdXNlckluZm8gPSByZXMuZGF0YS5kYXRhOwogICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgidXNlcklkIiwgdXNlckluZm8uaWQpOwogICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgidXNlckluZm8iLCBKU09OLnN0cmluZ2lmeSh1c2VySW5mbykpOwogICAgICAgICAgYWRhcHRlci5nZXRVc2VyUm9sZSh7CiAgICAgICAgICAgIGFjY2Vzc190b2tlbjogdG9rZW4sCiAgICAgICAgICAgIG9mZnNldDogLTEKICAgICAgICAgIH0sIGZ1bmN0aW9uICh0RGF0YSkgewogICAgICAgICAgICBjb25zb2xlLmxvZyh0RGF0YS5kYXRhKTsKICAgICAgICAgICAgdmFyIHJvbGVzID0gdERhdGEuZGF0YS5kYXRhIHx8IFtdOwogICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCJyb2xlcyIsIEpTT04uc3RyaW5naWZ5KHJvbGVzKSk7CiAgICAgICAgICAgIGxvY2F0aW9uLmhyZWYgPSBsb2NhdGlvbi5wcm90b2NvbCArICIvLyIgKyBsb2NhdGlvbi5ob3N0OwogICAgICAgICAgfSwgewogICAgICAgICAgICB1c2VySWQ6IHVzZXJJbmZvLmlkCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICBnZXRUb2tlbkJ5Q29kZShjb2RlKSB7CiAgICAgIHZhciB1cmwgPSBsb2NhdGlvbi5wcm90b2NvbCArICIvLyIgKyBsb2NhdGlvbi5ob3N0OwogICAgICB2YXIgZGF0YSA9IHsKICAgICAgICAiZ3JhbnRfdHlwZSI6ICJhdXRob3JpemF0aW9uX2NvZGUiLAogICAgICAgICJjbGllbnRfaWQiOiBjb25zdGFudC5hcHBJZCwKICAgICAgICAiY29kZSI6IGNvZGUsCiAgICAgICAgImNsaWVudF9zZWNyZXQiOiBjb25zdGFudC5jbGllbnRfc2VjcmV0LAogICAgICAgICJyZWRpcmVjdF91cmkiOiB1cmwKICAgICAgfTsKCiAgICAgIHZhciBfc2VsZiA9IHRoaXM7CgogICAgICBhZGFwdGVyLmdldFVzZXJUb2tlbihkYXRhLCBmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgY29uc3QgdG9rZW4gPSByZXMuZGF0YS5hY2Nlc3NfdG9rZW47CiAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgidG9rZW4iLCB0b2tlbik7CgogICAgICAgIF9zZWxmLmdldFVzZXJJbmZvKHRva2VuKTsKICAgICAgfSk7CiAgICB9CgogIH0KfTs="},{"version":3,"mappings":"AAYE,OAAOA,QAAP,MAAqB,sBAArB;AACA,eAAe;EACbC,IAAI,EAAE,YADO;;EAEbC,IAAI,GAAG;IACL,OAAO;MACLC,OAAO,EAAE;IADJ,CAAP;EAGD,CANY;;EAObC,OAAO,GAAG;IACR;IACA,IAAIC,IAAG,GAAIC,IAAI,CAACC,OAAL,EAAX;;IACA,IAAIF,IAAJ,EAAU;MACR;MACA,KAAKG,cAAL,CAAoBH,IAApB;IACF,CAHA,MAIK;MACHC,IAAI,CAACG,KAAL;IACF;EACD,CAjBY;;EAkBbC,OAAO,GAAG,CAAG,CAlBA;;EAmBbC,OAAO,EAAE;IACPC,WAAW,CAACC,KAAD,EAAQ;MACjBC,OAAO,CAACF,WAAR,CAAoB;QAACG,YAAY,EAAEF;MAAf,CAApB,EAA2C,UAASG,GAAT,EAAc;QACvD,IAAIA,GAAG,CAACd,IAAR,EAAc;UACV,IAAIe,QAAO,GAAID,GAAG,CAACd,IAAJ,CAASA,IAAxB;UACAgB,cAAc,CAACC,OAAf,CAAuB,QAAvB,EAAiCF,QAAQ,CAACG,EAA1C;UACAF,cAAc,CAACC,OAAf,CAAuB,UAAvB,EAAmCE,IAAI,CAACC,SAAL,CAAeL,QAAf,CAAnC;UACAH,OAAO,CAACS,WAAR,CAAoB;YAChBR,YAAY,EAAEF,KADE;YAEhBW,MAAM,EAAE,CAAC;UAFO,CAApB,EAGK,UAASC,KAAT,EAAgB;YACnBC,OAAO,CAACC,GAAR,CAAYF,KAAK,CAACvB,IAAlB;YACA,IAAI0B,KAAI,GAAIH,KAAK,CAACvB,IAAN,CAAWA,IAAX,IAAmB,EAA/B;YACAgB,cAAc,CAACC,OAAf,CAAuB,OAAvB,EAAgCE,IAAI,CAACC,SAAL,CAAeM,KAAf,CAAhC;YACAC,QAAQ,CAACC,IAAT,GAAgBD,QAAQ,CAACE,QAAT,GAAoB,IAApB,GAA2BF,QAAQ,CAACG,IAApD;UACD,CARD,EAQG;YACDC,MAAM,EAAEhB,QAAQ,CAACG;UADhB,CARH;QAYF;MACH,CAlBD;IAmBD,CArBM;;IAsBPZ,cAAc,CAACH,IAAD,EAAO;MACnB,IAAI6B,GAAE,GAAIL,QAAQ,CAACE,QAAT,GAAoB,IAApB,GAA2BF,QAAQ,CAACG,IAA9C;MACA,IAAI9B,IAAG,GAAI;QACT,cAAe,oBADN;QAET,aAAaF,QAAQ,CAACmC,KAFb;QAGT,QAAQ9B,IAHC;QAIT,iBAAiBL,QAAQ,CAACoC,aAJjB;QAKT,gBAAiBF;MALR,CAAX;;MAOA,IAAIG,KAAI,GAAI,IAAZ;;MACAvB,OAAO,CAACwB,YAAR,CAAqBpC,IAArB,EAA2B,UAASc,GAAT,EAAa;QACtC,MAAMH,KAAI,GAAIG,GAAG,CAACd,IAAJ,CAASa,YAAvB;QACAG,cAAc,CAACC,OAAf,CAAuB,OAAvB,EAAgCN,KAAhC;;QACAwB,KAAK,CAACzB,WAAN,CAAkBC,KAAlB;MACD,CAJD;IAKF;;EArCO;AAnBI,CAAf","names":["constant","name","data","loading","created","code","util","getCode","getTokenByCode","login","mounted","methods","getUserInfo","token","adapter","access_token","res","userInfo","sessionStorage","setItem","id","JSON","stringify","getUserRole","offset","tData","console","log","roles","location","href","protocol","host","userId","url","appId","client_secret","_self","getUserToken"],"sourceRoot":"","sources":["/Users/shonichikun/Downloads/西浦资料/authorityForecast/src/frameworks/transition.vue"],"sourcesContent":["<style lang=\"scss\" scoped>\r\n  .login {\r\n    height: 100vh;\r\n    background: url(~@/assets/img/bg_shadow.png) no-repeat center center;\r\n    background-size: cover;\r\n    overflow: hidden;\r\n  }\r\n</style>\r\n<template>\r\n  <div class=\"login\" v-loading=\"loading\"></div>\r\n</template>\r\n<script>\r\n  import constant from \"@/assets/js/constant\";\r\n  export default {\r\n    name: \"transition\",\r\n    data() {\r\n      return {\r\n        loading: true,\r\n      };\r\n    },\r\n    created() {\r\n      // cas重定向回来的 url中获取 code参数\r\n      let code = util.getCode();\r\n      if (code) {\r\n        // 根据 code获取 token\r\n        this.getTokenByCode(code);\r\n      }\r\n      else {\r\n        util.login();\r\n      }\r\n    },\r\n    mounted() { },\r\n    methods: {\r\n      getUserInfo(token) {\r\n        adapter.getUserInfo({access_token: token}, function(res) {\r\n          if (res.data) {\r\n              var userInfo = res.data.data;\r\n              sessionStorage.setItem(\"userId\", userInfo.id);\r\n              sessionStorage.setItem(\"userInfo\", JSON.stringify(userInfo));\r\n              adapter.getUserRole({\r\n                  access_token: token,\r\n                  offset: -1\r\n                }, function(tData) {\r\n                console.log(tData.data);\r\n                var roles = tData.data.data || []\r\n                sessionStorage.setItem(\"roles\", JSON.stringify(roles));\r\n                location.href = location.protocol + \"//\" + location.host;\r\n              }, {\r\n                userId: userInfo.id\r\n              })\r\n              \r\n            }\r\n        })\r\n      },\r\n      getTokenByCode(code) {\r\n        var url = location.protocol + \"//\" + location.host;\r\n        var data = {\r\n          \"grant_type\":  \"authorization_code\",\r\n          \"client_id\": constant.appId,\r\n          \"code\": code,\r\n          \"client_secret\": constant.client_secret,\r\n          \"redirect_uri\" : url\r\n        }\r\n        var _self = this;\r\n        adapter.getUserToken(data, function(res){\r\n          const token = res.data.access_token;\r\n          sessionStorage.setItem(\"token\", token);\r\n          _self.getUserInfo(token);\r\n        });\r\n      }\r\n    },\r\n  };\r\n</script>"]}]}