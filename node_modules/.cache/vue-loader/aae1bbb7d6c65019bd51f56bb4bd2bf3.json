{"remainingRequest":"E:\\golaxy\\zstp\\西浦大学\\authorityForecast\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!E:\\golaxy\\zstp\\西浦大学\\authorityForecast\\src\\frameworks\\transition.vue?vue&type=style&index=0&id=50548834&lang=scss&scoped=true","dependencies":[{"path":"E:\\golaxy\\zstp\\西浦大学\\authorityForecast\\src\\frameworks\\transition.vue","mtime":1657271700000},{"path":"E:\\golaxy\\zstp\\西浦大学\\authorityForecast\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\golaxy\\zstp\\西浦大学\\authorityForecast\\node_modules\\vue-loader-v16\\dist\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\golaxy\\zstp\\西浦大学\\authorityForecast\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\golaxy\\zstp\\西浦大学\\authorityForecast\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\golaxy\\zstp\\西浦大学\\authorityForecast\\node_modules\\@vue\\cli-service\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\golaxy\\zstp\\西浦大学\\authorityForecast\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQogIC5sb2dpbiB7DQogICAgaGVpZ2h0OiAxMDB2aDsNCiAgICBiYWNrZ3JvdW5kOiB1cmwofkAvYXNzZXRzL2ltZy9iZ19zaGFkb3cucG5nKSBuby1yZXBlYXQgY2VudGVyIGNlbnRlcjsNCiAgICBiYWNrZ3JvdW5kLXNpemU6IGNvdmVyOw0KICAgIG92ZXJmbG93OiBoaWRkZW47DQogIH0NCg=="},{"version":3,"sources":["E:\\golaxy\\zstp\\西浦大学\\authorityForecast\\src\\frameworks\\transition.vue"],"names":[],"mappings":";EACE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;IACL,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;IACb,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACpE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;IACtB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EAClB","file":"E:/golaxy/zstp/西浦大学/authorityForecast/src/frameworks/transition.vue","sourceRoot":"","sourcesContent":["<style lang=\"scss\" scoped>\r\n  .login {\r\n    height: 100vh;\r\n    background: url(~@/assets/img/bg_shadow.png) no-repeat center center;\r\n    background-size: cover;\r\n    overflow: hidden;\r\n  }\r\n</style>\r\n<template>\r\n  <div class=\"login\" v-loading=\"loading\"></div>\r\n</template>\r\n<script>\r\n  import constant from \"@/assets/js/constant\";\r\n  export default {\r\n    name: \"transition\",\r\n    data() {\r\n      return {\r\n        loading: true,\r\n      };\r\n    },\r\n    created() {\r\n      // cas重定向回来的 url中获取 code参数\r\n      let code = util.getCode();\r\n      if (code) {\r\n        // 根据 code获取 token\r\n        this.getTokenByCode(code);\r\n      }\r\n      else {\r\n        util.login();\r\n      }\r\n    },\r\n    mounted() { },\r\n    methods: {\r\n      getUserInfo(token) {\r\n        adapter.getUserInfo({access_token: token}, function(res) {\r\n          if (res.data) {\r\n              var userInfo = res.data.data;\r\n              sessionStorage.setItem(\"userId\", userInfo.id);\r\n              sessionStorage.setItem(\"userInfo\", JSON.stringify(userInfo));\r\n              adapter.getUserRole({\r\n                  access_token: token,\r\n                  offset: -1\r\n                }, function(tData) {\r\n                console.log(tData.data);\r\n                var roles = tData.data.data || []\r\n                sessionStorage.setItem(\"roles\", JSON.stringify(roles));\r\n                location.href = location.protocol + \"//\" + location.host;\r\n              }, {\r\n                userId: userInfo.id\r\n              })\r\n              \r\n            }\r\n        })\r\n      },\r\n      getTokenByCode(code) {\r\n        var url = location.protocol + \"//\" + location.host;\r\n        var data = {\r\n          \"grant_type\":  \"authorization_code\",\r\n          \"client_id\": constant.appId,\r\n          \"code\": code,\r\n          \"client_secret\": constant.client_secret,\r\n          \"redirect_uri\" : url\r\n        }\r\n        var _self = this;\r\n        adapter.getUserToken(data, function(res){\r\n          const token = res.data.access_token;\r\n          sessionStorage.setItem(\"token\", token);\r\n          _self.getUserInfo(token);\r\n        });\r\n      }\r\n    },\r\n  };\r\n</script>"]}]}