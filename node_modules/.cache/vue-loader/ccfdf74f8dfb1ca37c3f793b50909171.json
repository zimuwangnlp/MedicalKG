{"remainingRequest":"E:\\golaxy\\zstp\\西浦大学\\authorityForecast\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!E:\\golaxy\\zstp\\西浦大学\\authorityForecast\\src\\modules\\user.vue?vue&type=style&index=0&id=2ca6802c&lang=css","dependencies":[{"path":"E:\\golaxy\\zstp\\西浦大学\\authorityForecast\\src\\modules\\user.vue","mtime":1657014450000},{"path":"E:\\golaxy\\zstp\\西浦大学\\authorityForecast\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\golaxy\\zstp\\西浦大学\\authorityForecast\\node_modules\\vue-loader-v16\\dist\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\golaxy\\zstp\\西浦大学\\authorityForecast\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\golaxy\\zstp\\西浦大学\\authorityForecast\\node_modules\\@vue\\cli-service\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\golaxy\\zstp\\西浦大学\\authorityForecast\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQoubW9kdWxlSXRlbUFyZWEgew0KICBmbG9hdDogbGVmdDsNCiAgd2lkdGg6IDEwMCU7DQogIGhlaWdodDogMTAwJTsNCiAgZmlsdGVyOiAicHJvZ2lkOkRYSW1hZ2VUcmFuc2Zvcm0uTWljcm9zb2Z0LkFscGhhSW1hZ2VMb2FkZXIoc2l6aW5nTWV0aG9kPSdzY2FsZScpIjsNCiAgLW1vei1iYWNrZ3JvdW5kLXNpemU6IDEwMCUgMTAwJTsNCiAgYmFja2dyb3VuZC1zaXplOiAxMDB2dyAxMDAlOw0KICBkaXNwbGF5OiBibG9jazsNCiAgcG9zaXRpb246IHJlbGF0aXZlOw0KfQ0KDQoudG9wT3B0aW9uQXJlYSB7DQogIHBhZGRpbmc6IDE1cHggMTBweDsNCiAgdGV4dC1hbGlnbjogbGVmdDsNCn0NCg0KLnRhYmxlSW5mb0FyZWEgew0KICB3aWR0aDogMTAwJTsNCiAgaGVpZ2h0OiBjYWxjKDEwMCUgLSA2NXB4KTsNCn0NCg=="},{"version":3,"sources":["E:\\golaxy\\zstp\\西浦大学\\authorityForecast\\src\\modules\\user.vue"],"names":[],"mappings":";AAsYA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EACd,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EACX,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EACX,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EACZ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EAClF,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EAC/B,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EAC3B,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;EACd,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AACpB;;AAEA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EACb,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EAClB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AAClB;;AAEA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EACb,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EACX,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;AAC3B","file":"E:/golaxy/zstp/西浦大学/authorityForecast/src/modules/user.vue","sourceRoot":"","sourcesContent":["<template>\r\n<div class=\"moduleItemArea\">\r\n  <div class=\"topOptionArea\">\r\n    <el-button size=\"default\" type=\"primary\" @click=\"handleOpenDialog()\">新增用户</el-button>\r\n  </div>\r\n  <div class=\"tableInfoArea\">\r\n    <DataTable :dataObj=\"dataInfo\" @button-click=\"handleButtonClick\" @page-change=\"handlePageChange\"></DataTable>\r\n  </div>\r\n</div>\r\n<el-dialog :title=\"addDialogParam.title\" v-model=\"addDialogParam.visible\" :width=\"addDialogParam.width\">\r\n  <FormInfo ref=\"dialogForm\" :dataObj=\"addDialogParam.formData\"></FormInfo>\r\n  <template #footer v-if=\"addDialogParam.withFooter\">\r\n    <span class=\"dialog-footer\">\r\n      <el-button size=\"default\" @click=\"addDialogParam.visible = false\">取 消</el-button>\r\n      <el-button size=\"default\" type=\"primary\" @click=\"addDialogParam.visible = confirmUserDialog() \">确 定</el-button>\r\n    </span>\r\n  </template>\r\n</el-dialog>\r\n</template>\r\n\r\n<script>\r\nimport DataTable from \"./../components/dataTable\";\r\nimport FormInfo from \"./../components/formInfo\";\r\nimport constant from './../assets/js/constant';\r\nexport default {\r\n  name: '',\r\n  components: {\r\n    DataTable,\r\n    FormInfo\r\n  },\r\n  data() {\r\n    return {\r\n      appId: constant.appId,\r\n      token: sessionStorage.getItem('token'),\r\n      roles: [],\r\n      addDialogParam: {\r\n        title: \"新增用户\",\r\n        visible: false,\r\n        width: \"600px\",\r\n        withFooter: true,\r\n        formData: {\r\n          labelWidth: \"80px\",\r\n          result: {\r\n            name: \"\",\r\n            password: \"\",\r\n            realName: \"\",\r\n            roles: []\r\n          },\r\n          data: [{\r\n            key: 'name',\r\n            name: '用户名',\r\n            value: '',\r\n            type: 'text',\r\n            size: 'default',\r\n            items: [{\r\n              placeholder: '请输入用户名',\r\n            }, ],\r\n          }, {\r\n            key: 'password',\r\n            name: '登录密码',\r\n            value: '',\r\n            type: 'text',\r\n            showPassword: true,\r\n            size: 'default',\r\n            items: [{\r\n              placeholder: '请输入密码',\r\n            }, ],\r\n          }, {\r\n            key: 'realName',\r\n            name: '姓名',\r\n            value: '',\r\n            type: 'text',\r\n            size: 'default',\r\n            items: [{\r\n              placeholder: '请输入姓名',\r\n            }, ],\r\n          }, {\r\n            key: 'roles',\r\n            name: '所属角色',\r\n            value: '',\r\n            type: 'select',\r\n            multiple: true,\r\n            size: 'default',\r\n            items: [{\r\n              type: \"select\",\r\n              multiple: true,\r\n              placeholder: '请输入角色',\r\n              options: []\r\n            }, ],\r\n          }]\r\n        }\r\n      },\r\n      dataInfo: {\r\n        withIndex: true,\r\n        maxHeight: document.body.clientHeight - 200,\r\n        map: {\r\n          createTime: function (v) {\r\n            return util.transformPHPTime(v);\r\n          }\r\n        },\r\n        header: [{\r\n          //prop标识该元素所代表的数据列与data数组元素的哪个属性绑定\r\n          prop: 'name',\r\n          //label标识该元素所代表的数据列头名称标签\r\n          label: '用户名',\r\n        }, {\r\n          prop: 'realName',\r\n          label: '姓名',\r\n          width: '150',\r\n        }, {\r\n          prop: 'roleName',\r\n          label: '所属角色',\r\n          width: '150',\r\n        }, {\r\n          prop: 'createTime',\r\n          label: '创建时间',\r\n          width: '180',\r\n        }, {\r\n          prop: 'user',\r\n          label: '操作',\r\n          width: '220',\r\n          buttons: [{\r\n              label: '删除',\r\n              eventName: 'deleteItem',\r\n              size: 'default',\r\n            }, {\r\n              label: '重置密码',\r\n              eventName: 'resetPassword',\r\n              size: 'default',\r\n            },\r\n            {\r\n              label: '编辑',\r\n              eventName: 'editItem',\r\n              size: 'default',\r\n            }\r\n          ],\r\n        }],\r\n        data: [],\r\n        page: {\r\n           //background标识分页条是否有背景，有的话背景是什么\r\n          background: false,\r\n          //sizes标识当前分页条支持每页最多显示记录数可以切换的数值\r\n          sizes: [15, 30, 45, 60],\r\n          //pageSize标识当前分页条每页最多显示条数\r\n          pageSize: 15,\r\n          //layout标识当前分页条包含的操作元素\r\n          layout: 'total, sizes, prev, pager, next, jumper',\r\n          //total标识当前分页条对应数据总量总条数\r\n          total: 10,\r\n          currentPage: 1\r\n        }\r\n      }\r\n    };\r\n  },\r\n  watch: {\r\n    $route(to, from) {\r\n\r\n    },\r\n  },\r\n  computed: {\r\n\r\n  },\r\n  created() {\r\n    this.updateTabeInfo();\r\n    this.updateRoleSelector();\r\n  },\r\n  methods: {\r\n    confirmUserDialog() {\r\n      var _self = this;\r\n      var param = this.$refs.dialogForm.getFormValue();\r\n      var data = this.addDialogParam.current || {};\r\n      var d = {\r\n        \"appId\": this.appId,\r\n        \"name\": param.name,\r\n        \"realName\": param.realName,\r\n        \"password\": data.password || param.password,\r\n        \"id\": data.id || \"-1\",\r\n        \"idleTime\": data.idleTime || 86400,\r\n        \"expirTime\": data.expirTime || 86400,\r\n        \"loginFlag\": data.loginFlag || \"0\",\r\n        \"phone\": data.phone || \"\",\r\n        \"remarks\":  data.remarks || \"\"\r\n      }\r\n      if(!this.addDialogParam.flag) {\r\n         adapter.addUserItem(d, function (tData) {\r\n          if (tData.data.code === 200) {\r\n            var d = tData.data.data;\r\n            _self.setUserInfo(d.id, param.roles);\r\n          }\r\n        }, {\r\n          token: this.token\r\n        })\r\n      }\r\n      else {\r\n        adapter.updateUserItem(d, function (tData) {\r\n          if (tData.data.code === 200) {\r\n            _self.setUserInfo(d.id, param.roles, _self.addDialogParam.flag);\r\n          }\r\n        }, {\r\n          token: this.token\r\n        })\r\n      }\r\n     \r\n      return false;\r\n    },\r\n    setUserInfo(user, roles, flag) {\r\n      console.log(user, roles);\r\n      var _self = this;\r\n      if(!flag) {\r\n        adapter.setUserApplication([this.appId], function (tData) {\r\n          if (tData.data.code === 200) {\r\n            adapter.setUserRole(roles, function (tData) {\r\n              if (tData.data.code === 200) {\r\n                _self.$message({\r\n                  type: \"success\",\r\n                  message: \"添加用户成功。\"\r\n                });\r\n                _self.updateTabeInfo();\r\n              }\r\n            }, {\r\n              token: _self.token,\r\n              userId: user,\r\n              appId: _self.appId\r\n            })\r\n          }\r\n        }, {\r\n          token: this.token,\r\n          userId: user,\r\n        })\r\n      }\r\n      else {\r\n        adapter.setUserRole(roles, function (tData) {\r\n              if (tData.data.code === 200) {\r\n                _self.$message({\r\n                  type: \"success\",\r\n                  message: \"编辑用户成功。\"\r\n                });\r\n                _self.updateTabeInfo();\r\n              }\r\n            }, {\r\n              token: _self.token,\r\n              userId: user,\r\n              appId: _self.appId\r\n            })\r\n      }\r\n      \r\n\r\n    },\r\n    handleOpenDialog(data, flag) {\r\n      var result = {\r\n        name: \"\",\r\n        password: \"\",\r\n        realName: \"\",\r\n        roles: []\r\n      };\r\n      var item = this.addDialogParam.formData.data[0];\r\n      var tItem = this.addDialogParam.formData.data[1];\r\n      this.addDialogParam.flag = flag;\r\n      if (!flag) {\r\n        item.type = \"text\";\r\n        tItem.hide = false;\r\n        this.addDialogParam.title = \"新增用户\";\r\n      } else {\r\n        item.type = '';\r\n        // tItem.hide = true;\r\n        this.addDialogParam.title = \"编辑用户\";\r\n        this.addDialogParam.current = data;\r\n        result = {\r\n          name: data.name,\r\n          realName: data.realName,\r\n          roles: data.roleData.map(item => {\r\n            return item.id;\r\n          })\r\n        }\r\n      }\r\n\r\n      this.addDialogParam.formData.result = result;\r\n      if (this.$refs.dialogForm) {\r\n        this.$refs.dialogForm.updateFormValue(result);\r\n      }\r\n      this.addDialogParam.visible = true;\r\n    },\r\n    handleButtonClick(name, d) {\r\n      if (typeof this[name] === \"function\") {\r\n        this[name](d);\r\n      }\r\n    },\r\n    editItem(d) {\r\n      this.handleOpenDialog(d, true);\r\n    },\r\n    updateRoleSelector() {\r\n      var _self = this;\r\n      adapter.getAllRoles({\r\n        access_token: this.token,\r\n        offset: 0,\r\n      }, function (d) {\r\n        console.log(d.data.data);\r\n        _self.roles = d.data.data;\r\n        _self.addDialogParam.formData.data[3].items[0].options = _self.roles.map(item => {\r\n          item.label = item.name;\r\n          item.value = item.id;\r\n          return item;\r\n        });\r\n        // _self.roles[0] && (_self.appId = _self.roles[0].appId);\r\n      })\r\n    },\r\n    resetPassword(d) {\r\n      var _self = this;\r\n      this.$confirm('确定重置密码为: 123qwe吗？', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n      }).then(() => {\r\n        adapter.resetPassword(d, function (tData) {\r\n          if (tData.data.code === 200) {\r\n            _self.$message({\r\n              type: \"success\",\r\n              message: \"重置密码成功(123qwe)!\"\r\n            })\r\n          }\r\n        }, {\r\n          token: this.token,\r\n          userId: d.id,\r\n          password: \"123qwe\"\r\n        });\r\n      })\r\n    },\r\n    deleteItem(d) {\r\n      var _self = this;\r\n      this.$confirm('确定删除吗？', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n      }).then(() => {\r\n        adapter.deleteUserItem([d.id], function (tData) {\r\n          if (tData.data.code === 200) {\r\n            _self.$message({\r\n              type: \"success\",\r\n              message: \"删除用户成功!\"\r\n            });\r\n            _self.updateTabeInfo();\r\n          }\r\n\r\n        }, {\r\n          token: this.token,\r\n          appId: d.appId\r\n        });\r\n      })\r\n    },\r\n    handlePageChange(current, size) {\r\n      this.dataInfo.page.currentPage = current;\r\n      this.dataInfo.page.pageSize =  size;\r\n      this.updateTabeInfo();\r\n    },\r\n    updateTabeInfo() {\r\n      var _self = this;\r\n      adapter.getUserList({\r\n        access_token: this.token,\r\n        offset: (this.dataInfo.page.currentPage - 1) * this.dataInfo.page.pageSize,\r\n        count: this.dataInfo.page.pageSize\r\n      }, function (tData) {\r\n        _self.dataInfo.data = tData.data.data;\r\n        _self.dataInfo.page.total = tData.data.total;\r\n        _self.updateRoleInfo(_self.dataInfo.data);\r\n      })\r\n    },\r\n    updateRoleInfo(arr) {\r\n      for (let i = 0; i < arr.length; i++) {\r\n        this.getUserRole(arr[i]);\r\n      }\r\n    },\r\n    getUserRole(user) {\r\n      var _self = this;\r\n      adapter.getUserRole({\r\n        access_token: this.token,\r\n        offset: -1\r\n      }, function (tData) {\r\n        var roleData = tData.data.data;\r\n        var d = roleData.map(item => {\r\n          return item.name;\r\n        });\r\n        user.roleName = d.join(\",\");\r\n        user.roleData = roleData;\r\n      }, {\r\n        userId: user.id\r\n      })\r\n    }\r\n  },\r\n};\r\n</script>\r\n\r\n<style>\r\n.moduleItemArea {\r\n  float: left;\r\n  width: 100%;\r\n  height: 100%;\r\n  filter: \"progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='scale')\";\r\n  -moz-background-size: 100% 100%;\r\n  background-size: 100vw 100%;\r\n  display: block;\r\n  position: relative;\r\n}\r\n\r\n.topOptionArea {\r\n  padding: 15px 10px;\r\n  text-align: left;\r\n}\r\n\r\n.tableInfoArea {\r\n  width: 100%;\r\n  height: calc(100% - 65px);\r\n}\r\n</style>\r\n"]}]}